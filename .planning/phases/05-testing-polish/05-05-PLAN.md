---
phase: 5
plan: 05
wave: 2
autonomous: true
gap_closure: false
---

# Plan 05-05: Toggle and Theme Testing

## Objective

Test the ON/OFF toggle functionality and theme switching across all target sites to ensure reliable state management and clean cleanup.

**What this builds:** Verified toggle behavior and theme override functionality.

**Why it matters:** Users expect toggle OFF to completely remove styling, and theme override to work consistently.

## Requirements

- TEST-04: Dark mode test
- TEST-05: Toggle OFF test

## Tasks

### Task 1: Test Toggle OFF on All Sites

**Goal:** Verify toggle OFF completely removes all styling traces.

**Implementation:**
1. Navigate to each target site (Gemini, Kimi)
2. Enable extension, verify styling active
3. Click toggle OFF
4. Verify:
   - All `.claude-styled` classes removed
   - All injected stylesheets removed
   - Visual indicators disappear
   - Badge shows "OFF"
   - Page returns to original styling
5. Check console for cleanup logs

**Files to modify:**
- May fix: content/inject.js cleanup logic
- May fix: content/observer.js disconnect logic

**Commit:** fix(05-05): ensure complete cleanup on toggle OFF

### Task 2: Test Toggle ON After OFF

**Goal:** Verify toggle ON re-applies styling correctly.

**Implementation:**
1. With extension OFF, verify no styling
2. Click toggle ON
3. Verify:
   - Styling re-applies to existing content
   - New content gets styled
   - Badge clears "OFF"
   - Console shows initialization

**Files to modify:**
- May fix: content/inject.js re-initialization

**Commit:** fix(05-05): ensure clean re-initialization on toggle ON

### Task 3: Test Theme Override

**Goal:** Verify manual theme selection overrides auto-detection.

**Implementation:**
1. On site with dark mode detected
2. Select "Light" theme in popup
3. Verify light theme applied despite dark detection
4. Refresh page, verify override persists
5. Select "Auto" to restore detection
6. Verify auto-detection works again

**Files to modify:**
- May fix: popup/popup.js theme handling
- May fix: content/inject.js theme override logic

**Commit:** fix(05-05): ensure theme override persists correctly

### Task 4: Test Cross-Tab State Sync

**Goal:** Verify state changes sync across tabs of same site.

**Implementation:**
1. Open two Gemini tabs
2. Toggle OFF on one tab
3. Verify other tab also disables
4. Toggle ON on one tab
5. Verify other tab enables
6. Check badge updates on both

**Files to modify:**
- May fix: background.js broadcast logic

**Commit:** fix(05-05): ensure cross-tab state synchronization

### Task 5: Document Toggle/Theme Test Results

**Goal:** Create record of toggle and theme testing.

**Implementation:**
1. Add results to existing test documentation
2. Document any edge cases found
3. Note any timing issues

**Commit:** docs(05-05): document toggle and theme test results

## Success Criteria

- [ ] Toggle OFF removes all styling completely
- [ ] Toggle ON re-applies styling correctly
- [ ] Theme override persists across page reloads
- [ ] Cross-tab state sync works reliably
- [ ] No visual glitches during toggle transitions

## Dependencies

- Phase 4 (UI & State Management) must be complete

## Notes

- Test on both Gemini and Kimi
- Check for race conditions in state changes
- Verify localStorage cleanup on uninstall (if possible)
